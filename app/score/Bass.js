define(["channel/Bass", "controller/Conductor", "controller/Mediator"], function(Bass, Conductor, Mediator){

	var bassSynth = [

		["0:0", 0, "4n"], ["0:1", 0, "4n"], ["0:2", 0, "4n"], ["0:3", 0, "4n"],
		["1:0", 0, "4n"], ["1:1", 0, "4n"], ["1:2", 0, "4n"], ["1:3", 0, "4n"],
		["2:0", 0, "4n"], ["2:1", 0, "4n"], ["2:2", 0, "4n"],[ "2:3", 0, "4n"],
		
		["3:0", 0, "4n"], ["3:2", 0, "4n"], 
		["4:0", 0, "4n"], ["4:1", 0, "4n"], ["4:3", 0, "4n"], 
		["5:0", 0, "4n"], ["5:2", 0, "4n"],[ "5:3", 2, "4n"],
		
		["6:0", 0, "4n"], ["6:1:2",0, "4n"],["6:3", 0, "4n"], 
		["7:0", 0, "4n"], ["7:1:2",0, "4n"], ["7:3", 0, "4n"], 
		["8:0:2", 0, "4n"], ["8:2", 0, "4n"],[ "8:3", 0, "4n"],
		
		["9:0", 0, "4n"], ["9:1:2", 0, "4n"],["9:3", 0, "4n"], 
		["10:0", 0, "4n"], ["10:1:2", 0, "4n"], ["10:3", 0, "4n"], 
		["11:0:2", 0, "4n"], ["11:2", 0, "4n"],[ "11:3", 0, "4n"],

		//B
		["12:0", 0, "4n"], ["12:0:2", 0, "4n", 0.6], ["12:1:2", 0, "4n", 0.6], 
		["12:2", 0, "4n"], ["12:2:2", 0, "4n", 0.6], ["12:3:0", 0, "4n", 0.4],
		["13:0", 0, "4n"], ["13:0:2", 0, "4n", 0.6], ["13:1:2", 0, "4n", 0.6], 
		["13:2", 0, "4n"], ["13:2:2", 0, "4n", 0.6], ["13:3", 0, "4n", 0.4],
		["14:0", 0, "4n"], ["14:0:2", 0, "4n", 0.6], ["14:1:2", 0, "4n", 0.6], 
		["14:2", 0, "4n"], ["14:2:2", 0, "4n", 0.6], ["14:3", 0, "4n", 0.4],

		["15:0", 0, "16n", 1], ["15:1", 0, "16n", 0.5], ["15:2", 0, "16n", 0.5], ["15:3", 0, "16n", 0.5],
		["15:0:2", 0, "16n", 0.5], ["15:1:2", 0, "16n", 0.5], ["15:2:2", 0, "16n", 0.5], ["15:3:2", 0, "16n", 0.5],
		["16:0", 0, "16n", 1], ["16:1", 0, "16n", 0.5], ["16:2", 0, "16n", 0.5], ["16:3", 0, "16n", 0.5],
		["16:0:2", 0, "16n:2"], ["16:1:2", 0, "16n", 0.5], ["16:2:2", 0, "16n", 0.5], ["16:3:2", 0, "16n", 0.5],
		["17:0", 0, "16n", 1], ["17:1", 0, "16n", 0.5], ["17:2", 0, "16n", 0.5],[ "17:3", 0, "16n", 0.5],
		["17:0:2", 0, "16n:2"], ["17:1:2", 0, "16n", 0.5], ["17:2:2", 0, "16n", 0.5],[ "17:3:2", 0, "16n", 0.5],

		["18:0", 0, "4n"], ["18:2", 2, "4n"],
		["19:0", 0, "4n"], ["19:2", 2, "4n"],
		["20:0", 0, "4n"], ["20:2", 2, "4n"],

		["21:0", 0, "4n"], ["21:2", 1, "16n"], ["21:2:1", 2, "4n"],
		["22:0", 0, "4n"], ["22:2", 1, "16n"], ["22:2:1", 2, "4n"],
		["23:0", 0, "4n"], ["23:2", 1, "16n"], ["22:2:1", 2, "4n"],
	];		

	var chordNotes = {
		"Dm" : ["D2", "A1", "D3", "F2"],
		"A7" : ["A2", "E2", "G3", "A3"],
		"C7" : ["C2", "Bb1", "C3", "D2"],
		"Fmaj" : ["F2", "C2", "F3", "G2"],
		"D7" : ["D2", "C2", "D3", "E2"],
		"Gmaj" : ["G2", "D2", "B2", "G3"],
		"Cmaj" : ["C3", "G2", "D3", "G4"],
	};

	Conductor.parseScore(bassSynth, function(time, note, duration, probability, velocity){
		if (Conductor.hasBass()){
			var chordNote = chordNotes[Conductor.getChord()];
			if (!probability || Math.random() < probability){
				Bass.triggerAttackRelease(chordNote[note], duration, time, velocity);
				Mediator.deferSend("bass");
			}
		}
	});
});